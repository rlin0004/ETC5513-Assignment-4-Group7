---
title: "ETC5513 Assignment4 Group7"
author:
- familyname: xxxxx
  othernames: xxxxx
  address: Monash University
  correspondingauthor: true
- familyname: Evangelina
  othernames: Helen
  address: Monash University
- familyname: xxx
  othernames: xxx
  address: Monash University
department: Department of\newline Econometrics &\newline Business Statistics
organization: Acme Corporation
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  MonashEBSTemplates::report:
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache=TRUE, messages=FALSE, warning=FALSE)
# Make sure you have the latest versions of rmarkdown and bookdown installed
library(ggplot2)
library(tidyverse)
library(readxl)
library(lubridate)
library(kableExtra)
```


# Introduction

# Analysis

\section*{body 1}

\section*{body 2}
This section will be looking at the offenders by age group. Analysis such as the proportion of offenders in each age group, what principal offences account for the majority of the offences in each age group, and the changes in number of offenders will be discussed here.

```{r reading-data}
crime_age_201819 <- read_excel(here::here("data/1.+offenders,+australia.xls"), sheet = 4, range = "A5:M21")

crime_age_201718 <- read_excel(here::here("data/1.+offenders,+australia.xls"), sheet = 4, range = "A5:M38") 
crime_age_201718 <- crime_age_201718[-c(1:18),]
```

```{r age-data-cleaning}
crime_age_201819 <- crime_age_201819 %>%
  filter(!is.na(`Principal offence`))

#so that the data can be pivoted longer
crime_age_201718$`10–14 years` = as.double(crime_age_201718$`10–14 years`)
crime_age_201819$`10–14 years` = as.double(crime_age_201819$`10–14 years`)

crime_age_201718_2 <- crime_age_201718 %>%
  pivot_longer(cols = -`Principal offence`,
               names_to = "Age group",
               values_to = "Number of Offences")

crime_age_201718_2$Year <- "2017-2018"

crime_age_201819_2 <- crime_age_201819 %>%
  pivot_longer(cols = -`Principal offence`,
               names_to = "Age group",
               values_to = "Number of Offences") 

crime_age_201819_2$Year <- "2018-2019"

```

```{r binding-rows}
combined_age <- crime_age_201819_2 %>%
  bind_rows(crime_age_201718_2)

#changing column names
combined_age <- combined_age %>%
  rename("principal_offence" = `Principal offence`,
         "age_group" = `Age group`, 
         "number_offences" = `Number of Offences`)

combined_age$number_offences = as.numeric(combined_age$number_offences)

```

```{r total-age, fig.cap= "Number of offenders across age group"}
combined_age %>% 
  group_by(age_group,Year) %>%
  summarise(total = sum(number_offences)) %>%
  ggplot() +
  geom_col(aes(x = reorder(age_group, total),
             y= total,
             fill = age_group)) +
  facet_grid(~Year) +
  ylab("Total Number of Offences") +
  xlab("Age Group") +
  labs(title = "Distribution of Offenders by Age Group")  +
  coord_flip()
```
Figure \@ref(fig:total-age) shows the distribution of offenders across age groups, with each bar representing the total number of offences for certain age group. (should I include the year difference?) The highest proportion of offenders is from the age of 20-24 years, followed by 25-29 and 15-19 years, while the lowest proportion of offenders is from the 60-64 years age group. This indicates that older people tend to not commit an offence and the majority of the offenders are young people.

```{r age-yearly-changes, fig.cap="Distribution of total offenders yearly"}
combined_age %>% 
  group_by(age_group, Year) %>%
  summarise(total = sum(number_offences)) %>%
  ggplot() +
  geom_col(aes(x = Year,
             y= total,
             fill = Year)) +
  theme(axis.text.x = element_text(angle = 20, hjust = 1)) +
  ylab("Total Number of Offences") +
  xlab("Year") +
  labs(title = "Trend of Total Offenders by Year ") +
  facet_wrap(~age_group, scales = "free") +
  theme(axis.text.x = element_blank())
```

```{r summary-table}
total_1718 <- combined_age %>%
  filter(Year == "2017-2018") %>%
  group_by(age_group) %>%
  summarise(`Total 2017-2018` = sum(number_offences))

total_1819 <- combined_age %>%
  filter(Year == "2018-2019") %>%
  group_by(age_group) %>%
  summarise(`Total 2018-2019` = sum(number_offences))

total_all <- total_1718 %>%
  left_join(total_1819, 
            by = "age_group") %>% 
  mutate(Difference = (`Total 2018-2019` - `Total 2017-2018`)) %>%
  mutate(`Percentage Changes` = (Difference/`Total 2017-2018`)*100)

kable(total_all, caption = "Changes in total offenders") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```
An interesting trend to notice from Figure \@ref(fig:age-yearly-changes) and Table \@ref(tab:summary-table) is that the number of offences for age group below 45 decreased in 2018-2019, while it increased for age group above 45. This is due to the structural ageing that is experienced by all Australian states and territories (https://aic.gov.au/publications/tandi/tandi431). 
The overall changes however are not that high. Age group 10-14 years has the most significant change which is a decrease of 1310 or around -8.6%. And the age group with the least change is age group 35-39 years which is only a decrease of 68. The number of offences commited by the middle age groups do not change much.  


Next, we are looking at the top three highest age group in more details. 

```{r top-3}
top3age <- combined_age %>% 
  filter(age_group %in% c("20–24 years", "15–19 years", "25–29 years")) 

top3age %>%
  group_by(age_group, principal_offence, Year) %>%
  summarise(total = sum(number_offences)) %>%
  ggplot() +
  geom_col(aes(x = principal_offence,
             y= total,
             fill = principal_offence)) +
  facet_grid(age_group~Year, scales = "free") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  ylab("Total Number of Offences") +
  xlab("Principal Offence") +
  labs(title = "Number of Principal Offences in Highest 3 Age Group") +
  theme(axis.text.x = element_blank())
```
We can see a clear trend here that all age group has the highest number of offences in principal offence number 10, which is illicit drug offences. However, the number is decreasing in 2018-2019, which is resulted from 'lower level' offences being diverted from the courts https://www.aihw.gov.au/reports/alcohol/alcohol-tobacco-other-drugs-australia/contents/priority-populations/people-in-contact-with-the-criminal-justice-system

Some of the decrease may be the result of ‘lower level’ offences (such as minor drug possession) being diverted from the courts (ABS 2020a).

While the changes in other types of offence seem to be little, the changes for "Public order offences" seems to be high. (create a table for this perhaps?)

also look at lowest 3 and compare 
```{r lowest-3}
lowest3age <- combined_age %>% 
  filter(age_group %in% c("55–59 years", "60–64 years", "65 years and over")) 

lowest3age %>%
  group_by(age_group, principal_offence, Year) %>%
  summarise(total = sum(number_offences)) %>%
  ggplot() +
  geom_col(aes(x = principal_offence,
             y= total,
             fill = principal_offence)) +
  facet_grid(age_group~Year, scales = "free") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  ylab("Total Number of Offences") +
  xlab("Principal Offence") +
  labs(title = "Number of Principal Offences in Lowest 3 Age Group") +
  theme(axis.text.x = element_blank())
```
Figure \@ref(fig:lowest-3) illustrates the distribution of total offenders in each principal offences for the lowest 3 age groups. There are some differences compared to the top 3 age groups. The highest principal offence for these lowest 3 groups is "Acts intended to cause injury". Interesting findings here are that total offenders in "Illicit drug offences" decreased as the age group moves up and also "Offences against justice" and "Miscellaneous offences" tend to be higher in older ages compared to younger ages. While most of the offence types experienced an increase over time, one similar finding as in the top 3 data is that there is a significant decrease in "Public order offences".


Conclusion: Even though the total number of offenders differs across agr groups, the trend is pre similar with 10, 2, 13 being the top 3 highest principa offences.
Younger people tend to commit more crimes.
Rate of offenders decreased for thos below 45, while it increased for those above 45. 

\section*{body 3}

\section*{body 4}

# Conclusion

# Reference
