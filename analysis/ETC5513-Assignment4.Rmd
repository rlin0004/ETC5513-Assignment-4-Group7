---
title: "ETC5513 Assignment4 Group7"
author:
- familyname: xxxxx
  othernames: xxxxx
  address: Monash University
  correspondingauthor: true
- familyname: xxx
  othernames: xxx
  address: Monash University
  correspondingauthor: true
- familyname: xxx
  othernames: xxx
  address: Monash University
  correspondingauthor: true
department: Department of\newline Econometrics &\newline Business Statistics
organization: Acme Corporation
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  MonashEBSTemplates::report:
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache=TRUE, messages=FALSE, warning=FALSE)
# Make sure you have the latest versions of rmarkdown and bookdown installed
library(ggplot2)
library(readxl)
library(tidyverse)
library(here)
library(kableExtra)
```


# Introduction

# Analysis

\section*{body 1}

```{r read gender data}
gender_raw <- read_excel(here::here("data/1.+offenders,+australia.xls"), sheet = 3, col_types = c("text", rep("numeric", 22))) %>%
  rename("offence_type" = `Australian Bureau of Statistics`,
         "2008" = ...2,
         "2009" = ...3,
         "2010" = ...4,
         "2011" = ...5,
         "2012" = ...6,
         "2013" = ...7,
         "2014" = ...8,
         "2015" = ...9,
         "2016" = ...10,
         "2017" = ...11,
         "2018" = ...12) 
```



```{r clean gender}
male_count <- gender_raw[7:22, 1:12] %>%
  mutate(sex = "male")
female_count <- gender_raw[24:39, 1:12] %>%
  mutate(sex = "female") 
both_count <- gender_raw[41:56, 1:12] %>%
  mutate(sex = "both") 

gender <- bind_rows(male_count, female_count, both_count) %>%
  pivot_longer(cols = -c(offence_type, sex),
               names_to = "year",
               values_to = "count")
```

```{r gender1, fig.width=5}
gender %>%
  filter(sex != "both",
         offence_type != "Total") %>%
  group_by(year, offence_type, sex) %>%
  summarise(mean_year = mean(count, na.rm = TRUE)) %>%
  ggplot(aes(x = mean_year, y = offence_type)) +
  geom_col() +
  facet_wrap(~sex) +
  ylab("Offence Types") +
  xlab("Average annual Records") +
  ggtitle("Yearly average offence records of different offence type")
```

As showing in Figure \@ref(fig:gender1), each bar represents the average number of records for each type of offence and gender over the ten years. The overall offence recorded that the number of male offenders is significantly higher than female offenders. The highest number of offence type for males are “Acts intended to cause injury” and for female are “Theft”.  



```{r gendersumm}
gender %>%
  pivot_wider(names_from = sex, values_from = count) %>%
  select(- both) %>%
  group_by(offence_type) %>%
  summarise(avg_male = mean(male, na.rm = TRUE),
            avg_female = mean(female, na.rm = TRUE)) %>%
  mutate(result = if_else(
    condition = avg_male > avg_female,
    true = paste0("Males are ", round(avg_male / avg_female, 2), " times higher than females"),
    false = paste0("Females are ", round(avg_female / avg_male, 2), " times higher than males")
  )) %>%
  kable(col.names = c("Offence Type", "Avg.Male", "Avg.Female", "Result"),
        caption = "Summary of Yearly avergae records") %>%
  row_spec(c(1, 3, 5, 7, 9, 11, 13, 15), background = "lightblue") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) 
```

If we look at the summary (Refer to Table \@ref(tab:gendersumm)), the result also indicates that in all the offence types, the number of male offenders is significantly higher than female offenders. The “Sexual assault and related offence” is the most significant difference between the number of males and females, and the average number of males is about 17 times higher than females. The difference in “Theft” is relatively minimal; males are about 1.53 times higher than females. Over the ten years, the average number of male offenders is 4.42 times higher than that of females.

```{r gender2, fig.width=8}
gender %>%
   filter(sex != "both",
          offence_type != "Total") %>%
  ggplot(aes(x = year, y = count, group = offence_type, color = offence_type)) +
  geom_line() +
  facet_wrap(~sex)
```

From Figure \@ref(fig:gender2), we can observe that the yearly changes on the number of records of most types of the offence are stable on both genders. However, there still have some changes. For females, the number of “Theft” drop highly, from about 25,000 reduced to 15,000 and “Illicit drug offences” increased by nearly 10,000. For males, although some type offences remain at a relatively high level, “Unlawful entry with intent and Property damage” and “environmental pollution” have decreased by about 20,000. Government still need to pay attention to the issue of “Illicit drug offences”, because the number of records has increased a lot compared to 2008.



```{r clean gender rate}
gender_rate_raw <- gender_raw %>%
  select(offence_type, ...13:...23) %>%
  rename("2008" = ...13,
         "2009" = ...14,
         "2010" = ...15,
         "2011" = ...16,
         "2012" = ...17,
         "2013" = ...18,
         "2014" = ...19,
         "2015" = ...20,
         "2016" = ...21,
         "2017" = ...22,
         "2018" = ...23)

male_rate <- gender_rate_raw[7:22, 1:12] %>%
  mutate(sex = "male")
female_rate <- gender_rate_raw[24:39, 1:12] %>%
  mutate(sex = "female") 
both_rate <- gender_rate_raw[41:56, 1:12] %>%
  mutate(sex = "both") 

gender_rate <- bind_rows(male_rate, female_rate, both_rate) %>%
  pivot_longer(cols = -c(offence_type, sex),
               names_to = "year",
               values_to = "count")
```

```{r gender3}
gender_rate %>%
  filter(offence_type == "Total") %>%
  pivot_wider(names_from = sex, values_from = count) %>%
  select(-male, -female) %>%
  ggplot(aes(x = year, y = both)) +
  geom_col() +
  geom_text(aes(x = year, y = both - 500, label = both)) 
```

In Figure \@ref(fig:gender3), it represents the offender rate on both genders; the rate indicates the number of offenders in 100,000 people. In 2009, the rate was 2,062 offenders in 100,000 people. After the overall trend is decreasing, in 2018, there are about 1,794 offenders in 100,000 people. The rate decreased to their lowest levels in six years. 


```{r gendersumm2}
gender_rate %>%
  filter(offence_type == "Total") %>%
  filter(sex != "both") %>%
  pivot_wider(names_from = sex, values_from = count) %>%
  mutate(male_rate = (male - lag(male)) / lag(male),
         female_rate = (female - lag(female)) / lag(female)) %>%
  select(year, male_rate, female_rate) %>%
  slice(-1) %>%
  arrange(desc(year))
```

Focus on the change on the genders (Refer to Table \@ref(tab:gendersumm2)); the rate of both genders offenders is continuously decreasing in recent years. 

```{r gender changes}
summ_gender <- gender %>%
  filter(offence_type == "Total",
         year %in% c("2008", "2018"), 
         sex %in% c("male", "female")) %>%
  pivot_wider(names_from = year, values_from = count) %>%
  mutate(diff = `2018` - `2008`,
         rate = (`2018` - `2008`) / `2008`,
         type = "Number of Offender")


summ_gender_rate <- gender_rate %>%
  filter(offence_type == "Total",
         year %in% c("2008", "2018"), 
         sex %in% c("male", "female")) %>%
  pivot_wider(names_from = year, values_from = count) %>%
  mutate(diff = `2018` - `2008`,
         rate = (`2018` - `2008`) / `2008`,
         type = "Rate of Offender")
```

```{r gendersumm3}
bind_rows(summ_gender, summ_gender_rate) %>%
  select(type, sex, diff, rate, -offence_type, -`2008`, -`2018`) 
```

From Table \@ref(tab:gendersumm3), we can conclude that the number of offenders recorded in Australia increased on both males and females from 2008 to 2018. However, the rate of offenders recorded has dropped significantly, and the offence rate of males has decreased more than that of females.   

- The number of male offenders increased by 5,239, and the increasing rate is 1.79%.  
- The number of female offenders increased by 13,595, and the increasing rate is 16.63%.  
- The rate of male offenders has dropped by 408 per 100,000 people, and the decreasing rate is 12.93%.  
- The rate of female offenders has dropped by 9 per 100,000 people, and the decreasing rate is 1.07%.  




\section*{body 2}

\section*{body 3}

# Conclusion

# Reference