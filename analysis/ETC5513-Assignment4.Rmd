---
title: "ETC5513 Assignment4 Group7"
author:
- familyname: xxxxx
  othernames: xxxxx
  address: Monash University
  correspondingauthor: true
- familyname: Evangelina
  othernames: Helen
  address: Monash University
- familyname: xxx
  othernames: xxx
  address: Monash University
department: Department of\newline Econometrics &\newline Business Statistics
organization: Acme Corporation
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  MonashEBSTemplates::report:
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache=TRUE, messages=FALSE, warning=FALSE)
# Make sure you have the latest versions of rmarkdown and bookdown installed
library(ggplot2)
library(tidyverse)
library(readxl)
library(lubridate)
```


# Introduction

# Analysis

\section*{body 1}

\section*{body 2}
```{r reading-data}
crime_age_201819 <- read_excel(here::here("data/1.+offenders,+australia.xls"), sheet = 4, range = "A5:M21")

crime_age_201718 <- read_excel(here::here("data/1.+offenders,+australia.xls"), sheet = 4, range = "A5:M38") 
crime_age_201718 <- crime_age_201718[-c(1:18),]
```

```{r age-data-cleaning}
crime_age_201819 <- crime_age_201819 %>%
  filter(!is.na(`Principal offence`))

#so that the data can be pivoted longer
crime_age_201718$`10–14 years` = as.double(crime_age_201718$`10–14 years`)
crime_age_201819$`10–14 years` = as.double(crime_age_201819$`10–14 years`)

crime_age_201718_2 <- crime_age_201718 %>%
  pivot_longer(cols = -`Principal offence`,
               names_to = "Age group",
               values_to = "Number of Offences")

crime_age_201718_2$Year <- "2017-2018"

crime_age_201819_2 <- crime_age_201819 %>%
  pivot_longer(cols = -`Principal offence`,
               names_to = "Age group",
               values_to = "Number of Offences") 

crime_age_201819_2$Year <- "2018-2019"

```

```{r binding-rows}
combined_age <- crime_age_201819_2 %>%
  bind_rows(crime_age_201718_2)

#changing column names
combined_age <- combined_age %>%
  rename("principal_offence" = `Principal offence`,
         "age_group" = `Age group`, 
         "number_offences" = `Number of Offences`)

combined_age$number_offences = as.numeric(combined_age$number_offences)

```

```{r creating-graph}
combined_age %>% 
  group_by(age_group) %>%
  summarise(total = sum(number_offences)) %>%
  ggplot() +
  geom_col(aes(x = reorder(age_group, total),
             y= total,
             fill = age_group)) +
 # theme(axis.text.x = element_text(angle = 20, hjust = 1)) +
  ylab("Total Number of Offences") +
  xlab("Age Group") +
  labs(title = "Distribution of Offenders by Age Group")  +
  coord_flip()
```

```{r creating-graph2}
combined_age %>% 
  group_by(age_group, Year) %>%
  summarise(total = sum(number_offences)) %>%
  ggplot() +
  geom_col(aes(x = age_group,
             y= total,
             fill = Year)) +
  theme(axis.text.x = element_text(angle = 20, hjust = 1)) +
  ylab("Total Number of Offences") +
  xlab("Age Group") +
  labs(title = "Distribution of Offenders by Age Group")
```

```{r creating-graph2}
combined_age %>% 
  group_by(age_group, Year) %>%
  summarise(total = sum(number_offences)) %>%
  ggplot() +
  geom_col(aes(x = Year,
             y= total,
             fill = Year)) +
  theme(axis.text.x = element_text(angle = 20, hjust = 1)) +
  ylab("Total Number of Offences") +
  xlab("Year") +
  labs(title = "Distribution of Offenders by Age Group and Year") +
  facet_wrap(~age_group)
```

```{r}
combined_age %>% 
  group_by(age_group, principal_offence) %>%
  summarise(total = sum(number_offences)) %>%
  ggplot() +
  geom_col(aes(x = age_group,
             y= total,
             fill = age_group)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  ylab("Total Number of Offences") +
  xlab("Age Group") +
  labs(title = "Distribution of Offenders by Age Group") +
  facet_wrap(~principal_offence)
```

It can be noticed that the highest number of offenders belong to the age group of 20-24, 25-29, and 15-19, therefore we look at these age groups in more details.
```{r}
top3age <- combined_age %>% 
  filter(age_group %in% c("20–24 years", "15–19 years", "25–29 years")) 

top3age %>%
  group_by(age_group, principal_offence, Year) %>%
  summarise(total = sum(number_offences)) %>%
  ggplot() +
  geom_col(aes(x = principal_offence,
             y= total,
             fill = principal_offence)) +
  facet_grid(age_group~Year) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  ylab("Total Number of Offences") +
  xlab("Principal Offence") +
  labs(title = "Distribution of Offenders by Age Group") +
  theme(axis.text.x = element_blank())
```
We can see a clear trend here that all age group has the highest number of offences in principal offence number 10, which is illicit drug offences. However, the number is decreasing in 2018-2019.

\section*{body 3}

\section*{body 4}

# Conclusion

# Reference
